<HTML>
<HEAD>
<TITLE>Return Sequence Optimization</TITLE>
<LINK REL="STYLESHEET" TYPE="TEXT/CSS" HREF="style.css">
</HEAD>
<BODY BGCOLOR="#FFFFF8">
<TABLE CLASS="INVTABLE" WIDTH="100%">
<TR>
<TD CLASS="NOBORDER" WIDTH="40"><IMG SRC="info.gif" WIDTH="32" HEIGHT="32" BORDER="0"></TD>
<TD CLASS="TITLE">Return Sequence Optimization</TD>
</TR>
</TABLE>
<HR>
<TABLE CLASS="NOBORDER" WIDTH="100%"><TR>
<TD CLASS="HEADER" ALIGN="LEFT" WIDTH="60"><A HREF="ld_bincode_nop.html">Previous</A></TD>
<TD CLASS="HEADER" ALIGN="CENTER"><A HREF="ld_bincode.html">TIGCC Linker Binary Code Fixup</A></TD>
<TD CLASS="HEADER" ALIGN="RIGHT" WIDTH="60"><A HREF="ld_bincode_branch.html">Next</A></TD>
</TR></TABLE>
<P>The TIGCC linker can optimize function return sequences. If a section ends
with a subroutine branch followed by a simple return instruction, the
subroutine branch is converted into a simple unconditional branch (jump),
and the return instruction is removed. Note that this may fail easily if
there is a branch to the return instruction somewhere; if the return
instruction is removed, the branch will point to arbitrary code or data.
You can make this less likely by telling the assembler to emit all local
labels, so the linker knows it cannot optimize a return sequence because
there is a label in front of the return instruction. With the
<A HREF="gnuasm.html">GNU Assembler</A>, this is done by using the
<B>'--keep-locals'</B> option, which is included automatically if
range-cutting is enabled. With the <A HREF="a68k.html">A68k Assembler</A>,
the <B>'-d'</B> switch does the job.
</BODY>
</HTML>
